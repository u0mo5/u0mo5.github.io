<!DOCTYPE html>
<html lang="english">
<head>

        <title>mysql分页原理和高效率的mysql分页查询语句</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/">读书圈博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>


              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/3784.html" rel="bookmark"
                   title="Permalink to mysql分页原理和高效率的mysql分页查询语句">mysql分页原理和高效率的mysql分页查询语句</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                Thu 01 January 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>这篇文章主要介绍了mysql分页原理和高效率的mysql分页查询语句,大家参考使用吧
 
 </p>
<p>以前我在mysql中分页都是用的 limit 100000,20这样的方式，我相信你也是吧，但是要提高效率，让分页的代码效率更高一些，更快一些,那我们又该怎么做呢?
第一部分：看一下分页的基本原理：
 
mysql explain SELECT * FROM message ORDER BY id DESC LIMIT 10000, 20
<strong><em>*</em></strong><strong><em>*</em></strong><strong><em> 1. row </em></strong><strong><em>*</em></strong>****id: 
1select_type: SIMPLEtable: messagetype: indexpossible_keys: 
NULLkey: PRIMARYkey_len: 4ref: NULLrows: 10020Extra:1 
row in set (0.00 sec)
 
对上面的mysql语句说明：limit 
10000,20的意思扫描满足条件的10020行，扔掉前面的10000行，返回最后的20行，问题就在这里，如果是limit 
100000,100，需要扫描100100行，在一个高并发的应用里，每次查询需要扫描超过10W行，性能肯定大打折扣。文中还提到limit 
n性能是没问题的，因为只扫描n行。
第二部分：根据雅虎的几位工程师带来了一篇Efficient Pagination Using 
MySQL的报告内容扩展：在文中提到一种clue的做法，给翻页提供一些线索，比如还是SELECT * FROM message ORDER BY id 
DESC，按id降序分页，每页20条，当前是第10页，当前页条目id最大的是1020，最小的是1000，如果我们只提供上一页、下一页这样的跳转（不提供到第N页的跳转），那么在处理上一页的时候SQL语句可以是：
代码如下:</p>
<p>SELECT * FROM message WHERE id&gt;1020 
ORDER BY id ASC LIMIT 20;//下一页
 
处理下一页的时候SQL语句可以是：</p>
<p>代码如下:</p>
<p>SELECT * FROM message WHERE id&lt;1000 
ORDER BY id DESC LIMIT 20;//上一页
 
不管翻多少页，每次查询只扫描20行。
缺点是只能提供上一页、下一页的链接形式，但是我们的产品经理非常喜欢“上一页 1 2 3 4 5 6 7 8 9 下一页”这样的链接方式，怎么办呢？
如果LIMIT m,n不可避免的话，要优化效率，只有尽可能的让m小一下，我们扩展前面的clue做法，还是SELECT * FROM message 
ORDER BY id DESC，按id降序分页，每页20条，当前是第10页，当前页条目id最大的是2519，最小的是2500;
当是第10页的SQL如下：
代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&gt;=2500 ORDER BY auto_id ASC LIMIT 0,20</p>
<p>比如要跳到第9页，SQL语句可以这样写：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&lt;2500 ORDER BY auto_id desc LIMIT 0,20</p>
<p>比如要跳到第8页，SQL语句可以这样写：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&lt;2500 ORDER BY auto_id desc LIMIT 20,20</p>
<p>比如要跳到第7页，SQL语句可以这样写：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&lt;2500 ORDER BY auto_id desc LIMIT 40,20</p>
<p>跳转到第11页：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&gt;2519 ORDER BY auto_id asc LIMIT 0,20</p>
<p>跳转到第12页：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&gt;2519 ORDER BY auto_id asc LIMIT 20,20</p>
<p>跳转到第13页：代码如下:</p>
<p>SELECT * FROM tb_goods_info WHERE auto_id 
&gt;2519 ORDER BY auto_id asc LIMIT 40,20
 
原理还是一样，记录住当前页id的最大值和最小值，计算跳转页面和当前页相对偏移，由于页面相近，这个偏移量不会很大，这样的话m值相对较小，大大减少扫描的行数。其实传统的limit 
m,n，相对的偏移一直是第一页，这样的话越翻到后面，效率越差，而上面给出的方法就没有这样的问题。
注意SQL语句里面的ASC和DESC，如果是ASC取出来的结果，显示的时候记得倒置一下。
已在60W数据总量的表中测试，效果非常明显</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">

<h4>Pages</h4>

 <ul>
  </ul>

<h4>Categories</h4>
<ul class="blank">
		<li><a href="/category/default.html">default</a></li>
		<li><a href="/category/java.html">java</a></li>
		<li><a href="/category/javascript.html">javascript</a></li>
		<li><a href="/category/linux.html">linux</a></li>
		<li><a href="/category/mysql.html">mysql</a></li>
		<li><a href="/category/php.html">php</a></li>
		<li><a href="/category/python.html">python</a></li>
		<li><a href="/category/windows.html">windows</a></li>
</ul>


<h4>Tags</h4>


<nav class="widget">
  <h4>Social</h4>
  <ul class="blank">
    <li><a href="http://bookfuns.com">读书圈</a></li>
    <li><a href="http://123.bookfuns.com">网址大全</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
</body>
</html>