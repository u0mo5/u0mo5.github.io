<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>【MySql】赶集网mysql开发36条军规</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/">读书圈博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">首页</a></li>


              </ul>

            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/4136.html" rel="bookmark"
                   title="Permalink to 【MySql】赶集网mysql开发36条军规">【MySql】赶集网mysql开发36条军规</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                周四 01 一月 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>【MySql】赶集网mysql开发36条军规 2012-05-14 14:02:33</p>
<p>分类： Linux
 </p>
<p>写在前面的话：
总是在灾难发生后，才想起容灾的重要性；
总是在吃过亏后，才记得曾经有人提醒过。
(一)核心军规
(1)不在数据库做运算
   cpu计算务必移至业务层；
(2)控制单表数据量
   int型不超过1000w，含char则不超过500w；
   合理分表；
   限制单库表数量在300以内；
(3)控制列数量
   字段少而精，字段数建议在20以内；
(4)平衡范式与冗余
   效率优先；
   往往牺牲范式；
(5)拒绝3B
   拒绝大sql语句：big sql
   拒绝大事物：big transaction
   拒绝大批量：big batch
 
(二)字段类军规
(6)用好数值类型
   tinyint(1Byte)
   smallint(2Byte)
   mediumint(3Byte)
   int(4Byte)
   bigint(8Byte)
   bad case：int(1)/int(11)
(7)字符转化为数字
   用int而不是char(15)存储ip
(8)优先使用enum或set
   例如：<code>sex</code> enum (‘F’, ‘M’)
(9)避免使用NULL字段
   NULL字段很难查询优化；
   NULL字段的索引需要额外空间；
   NULL字段的复合索引无效；
   bad case：
    <code>name</code> char(32) default null
    <code>age</code> int not null
   good case：
    <code>age</code> int not null default 0
(10)少用text/blob
    varchar的性能会比text高很多；
    实在避免不了blob，请拆表；
(11)不在数据库里存图片
    这个我不能理解！
    但这是赶集网的经验，求detail！
 
(三)索引类军规
(12)谨慎合理使用索引
    改善查询、减慢更新；
    索引一定不是越多越好(能不加就不加，要加的一定得加)；
    覆盖记录条数过多不适合建索引，例如“性别”；
(13)字符字段必须建前缀索引
(14)不在索引做列运算
！！！不只是索引，都不能做列运算吧！！！
    bad case：
    select id where age +1 = 10;
(15)innodb主键推荐使用自增列；
    主键建立聚簇索引；
    主键不应该被修改；
    字符串不应该做主键；
    如果不指定主键，innodb会使用唯一且非空值索引代替；
(16)不用外键
    请由程序保证约束；
 
(四)sql类军规
(17)sql语句尽可能简单
    一条sql只能在一个cpu运算；
    大语句拆小语句，减少锁时间；
    一条大sql可以堵死整个库；
(18)简单的事务
    事务时间尽可能短；
    bad case：
    上传图片事务
(19)避免使用trig/func
    触发器、函数不用；
    客户端程序取而代之；
(20)不用select <em>
    消耗cpu，io，内存，带宽；
    这种程序不具有扩展性；
(21)OR改写为IN()
    or的效率是n级别；
    in的消息时log(n)级别；
    in的个数建议控制在200以内；
      select id from t where phone=’159′ or phone=’136′;
      =&gt;
      select id from t where phone in (’159′, ’136′);
(22)OR改写为UNION
    mysql的索引合并很弱智
     select id from t where phone = ’159′ or name = ‘john’;
     =&gt;
     select id from t where phone=’159′
     union
     select id from t where name=’jonh’
(23)避免负向%
(24)慎用count(</em>)
(25)同上
(26)limit高效分页
    limit越大，效率越低
    select id from t limit 10000, 10;
    =&gt;
    select id from t where id &gt; 10000 limit 10;
(27)使用union all替代union
    union有去重开销
(28)少用连接join
(29)使用group by
    分组；
    自动排序；
(30)请使用同类型比较
(31)使用load data导数据
    load data比insert快约20倍；
(32)打散批量更新
(33)新能分析工具
    show profile;
    mysqlsla;
    mysqldumpslow;
    explain;
    show slow log;
    show processlist;
    show query_response_time(percona);</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">
<h4>站内搜索</h4>
              <div class="navbar-search pull-right">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=8305292233022102519' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
              </div>    

<h4>页面</h4>

 <ul>
  </ul>

<h4>分类</h4>
<ul class="blank">
		<li><a href="/category/android.html">android</a></li>
		<li><a href="/category/api.html">api</a></li>
		<li><a href="/category/git.html">git</a></li>
		<li><a href="/category/go.html">go</a></li>
		<li><a href="/category/hack.html">hack</a></li>
		<li><a href="/category/ios.html">ios</a></li>
		<li><a href="/category/java.html">java</a></li>
		<li><a href="/category/javascript.html">javascript</a></li>
		<li><a href="/category/linux.html">linux</a></li>
		<li><a href="/category/mysql.html">mysql</a></li>
		<li><a href="/category/operation.html">operation</a></li>
		<li><a href="/category/others.html">others</a></li>
		<li><a href="/category/php.html">php</a></li>
		<li><a href="/category/program.html">program</a></li>
		<li><a href="/category/python.html">python</a></li>
		<li><a href="/category/read.html">read</a></li>
		<li><a href="/category/soft.html">soft</a></li>
		<li><a href="/category/success.html">success</a></li>
		<li><a href="/category/test.html">test</a></li>
		<li><a href="/category/vcs.html">vcs</a></li>
		<li><a href="/category/windows.html">windows</a></li>
</ul>


<h4>标签</h4>


<nav class="widget">
  <h4>友情链接</h4>
  <ul class="blank">
    <li><a href="http://bookfuns.com">读书圈</a></li>
    <li><a href="http://123.bookfuns.com">网址大全</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
</body>
</html>