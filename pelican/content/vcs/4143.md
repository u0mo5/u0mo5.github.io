Title: 做了一个简易的git 代码自动部署脚本
Date: 1970-01-01 00:00:00
Modified: 1970-01-01 00:00:00
cat: default
Tags: 
Slug: 4143
Authors: u0mo5 
Summary: 


做了一个简易的git 代码自动部署脚本
http://my.oschina.net/caomenglong/blog/472665
发表于2个月前(2015-06-30 21:08)   阅读（200） | 评论（1） 12人收藏此文章, 我要收藏

赞1

8月22日珠海 OSC 源创会正在报名，送机械键盘和开源无码内裤  


项目是THINKPHP写的 用了 oschina git 进行版本管理。
公网服务器是CentOS。每次用FTP上传很麻烦。
所以想到了在服务器上安装一个GIT进行 pull代码。因为我的远程服务器数据库和本地不一样，所以代码pull后还需要修改 几个config.php数据库配置文件。
所以想再git 代码更新后，要自动执行config.php文件的替换或者修改。
其中看到这里讨论http://www.v2ex.com/t/81173  git hook
然后看了下比较麻烦。也看不懂。
所以就自己写了一个SH脚本 效果非常不错。分享出来。
首先再服务器中建立一个文件夹，把项目代码clone下来。


?


1




git clone https://caomenglong@git.oschina.net/yfsoft/GR_Operate.git






代码仓库地址：


?


1



~/codes/ec.abc.com/GR_Operate





项目部署目录


?


1



/www/web/abc/public_html





test.sh


?


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16



#!/bin/sh

a="Please input your git account password"


echo $a

cd ~/codes/ec.abc.com/GR_Operate
git pull
cd /www/web/abc/public_html
rm -rf *
cp -r ~/codes/ec.abc.com/GR_Operate/* /www/web/abc/public_html
rm -rf /www/web/abc/public_html/Application/Common/Conf/config.php
rm -rf /www/web/abc/public_html/Application/User/Conf/config.php
cp /root/codes/ec.abc.com/needcopy/common_config.php /www/web/abc/public_html/Application/Common/Conf/config.php
cp /root/codes/ec.abc.com/needcopy/user_config.php /www/web/abc/public_html/Application/User/Conf/config.php

chown -R www *


chown -R :www *


echo "git pull success and cpoy codes to www folder done "


echo "SUCCESS!!"






原理很简单。先进入git目录 执行 git pull 更新代码
然后进入网站WWW目录删除所有的代码。
然后复制git目录下的代码到www目录下。
删除2个config.php文件，复制修改好的文件到相应目录下。
最后修改所有的文件和文件夹加入 用户权限和用户组权限。
 
使用方法很简单


?


1




./test.sh







