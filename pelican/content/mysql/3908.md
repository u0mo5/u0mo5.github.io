Title: SSH框架系列：Spring配置多个数据源
Date: 1970-01-01 00:00:00
Modified: 1970-01-01 00:00:00
cat: default
Tags: 
Slug: 3908
Authors: u0mo5 
Summary: 


 

分类： 【java】2013-12-09 16:59 1247人阅读 评论(0) 收藏 举报

1.问题的引入
         对于普通的SSH框架而言，一般配置一个数据源，一个SessionFactory，一个事务管理和对应的ProxyCreate。那么当项目需要操作多个数据库时，如何配置呢？
方案1
配置2个数据源，2个对应的SessionFactory，2个事务等。Spring的配置如下：
 



[html] view plaincopy
 



&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;beans xmlns="http://www.springframework.org/schema/beans"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"  

    xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"  

    xsi:schemaLocation="http://www.springframework.org/schema/beans  

    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  
    http://www.springframework.org/schema/tx   
    http://www.springframework.org/schema/tx/spring-tx-3.0.xsd  
    http://www.springframework.org/schema/aop  
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd  
    http://www.springframework.org/schema/context  
    http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;  

    &lt;!-- 引入datasource配置文件 --&gt;  

    &lt;context:property-placeholder location="classpath:datasource.properties" /&gt;  

    &lt;!--创建mysql jdbc数据源 --&gt;  

    &lt;bean id="mysqlDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"  

        destroy-method="close"&gt;  

        &lt;property name="driverClass" value="${jdbc.mysql.driver}" /&gt;  

        &lt;property name="jdbcUrl" value="${jdbc.mysql.url}" /&gt;  

        &lt;property name="user" value="${jdbc.mysql.username}" /&gt;  

        &lt;property name="password" value="${jdbc.mysql.password}" /&gt;  

        &lt;!-- 指定连接数据库连接池的最小连接数 --&gt;  

        &lt;property name="minPoolSize" value="10" /&gt;  

        &lt;!-- 指定连接数据库连接池的最大连接数 --&gt;  

        &lt;property name="maxPoolSize" value="30" /&gt;  

        &lt;!-- 指定连接数据库连接池的连接的最大空闲时间 --&gt;  

        &lt;property name="maxIdleTime" value="1800" /&gt;  

        &lt;property name="acquireIncrement" value="2" /&gt;  

        &lt;property name="maxStatements" value="0" /&gt;  

        &lt;!-- 指定连接数据库连接池的初始化连接数 --&gt;  

        &lt;property name="initialPoolSize" value="2" /&gt;  

        &lt;property name="idleConnectionTestPeriod" value="1800" /&gt;  

        &lt;!-- 当连接失败时，尝试重新连接的次数 --&gt;  

        &lt;property name="acquireRetryAttempts" value="30" /&gt;  

        &lt;property name="breakAfterAcquireFailure" value="true" /&gt;  

        &lt;property name="testConnectionOnCheckout" value="false" /&gt;  

    &lt;/bean&gt;  

    &lt;!--创建oracle jdbc数据源 --&gt;  

    &lt;bean id="oracleDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"  

        destroy-method="close"&gt;  

        &lt;property name="driverClass" value="${jdbc.oracle.driver}" /&gt;  

        &lt;property name="jdbcUrl" value="${jdbc.oracle.url}" /&gt;  

        &lt;property name="user" value="${jdbc.oracle.username}" /&gt;  

        &lt;property name="password" value="${jdbc.oracle.password}" /&gt;  

        &lt;!-- 指定连接数据库连接池的最小连接数 --&gt;  

        &lt;property name="minPoolSize" value="10" /&gt;  

        &lt;!-- 指定连接数据库连接池的最大连接数 --&gt;  

        &lt;property name="maxPoolSize" value="30" /&gt;  

        &lt;!-- 指定连接数据库连接池的连接的最大空闲时间 --&gt;  

        &lt;property name="maxIdleTime" value="1800" /&gt;  

        &lt;property name="acquireIncrement" value="2" /&gt;  

        &lt;property name="maxStatements" value="0" /&gt;  

        &lt;!-- 指定连接数据库连接池的初始化连接数 --&gt;  

        &lt;property name="initialPoolSize" value="2" /&gt;  

        &lt;property name="idleConnectionTestPeriod" value="1800" /&gt;  

        &lt;!-- 当连接失败时，尝试重新连接的次数 --&gt;  

        &lt;property name="acquireRetryAttempts" value="1" /&gt;  

        &lt;property name="breakAfterAcquireFailure" value="true" /&gt;  

        &lt;property name="testConnectionOnCheckout" value="false" /&gt;  

    &lt;/bean&gt;  

    &lt;!-- 创建MysqlSessionFactory--&gt;  

    &lt;bean id="mysqlSessionFactory"  

        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt;  

        &lt;property name="dataSource" ref="mysqlDataSource" /&gt;  

        &lt;property name="hibernateProperties"&gt;  

            &lt;props&gt;  

                &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;  

                &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;  

                &lt;prop key="current_session_context_class"&gt;thread&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

        &lt;property name="mappingResources"&gt;  

            &lt;list&gt;  

                &lt;value&gt;edu/njupt/zhb/model/mysql/Student.hbm.xml&lt;/value&gt;  

            &lt;/list&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

  
    &lt;!-- 创建OracleSessionFactory--&gt;  

    &lt;bean id="oracleSessionFactory"  

        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt;  

        &lt;property name="dataSource" ref="oracleDataSource" /&gt;  

        &lt;property name="hibernateProperties"&gt;  

            &lt;props&gt;  

                &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;  

                &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.OracleDialect&lt;/prop&gt;  

                &lt;prop key="current_session_context_class"&gt;thread&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

        &lt;property name="mappingResources"&gt;  

            &lt;list&gt;  

                &lt;value&gt;edu/njupt/zhb/model/oracle/Student.hbm.xml&lt;/value&gt;  

            &lt;/list&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

      
    &lt;!-- 配置Mysql事务 --&gt;  

    &lt;bean id="mysqlTransactionManager"  

        class="org.springframework.orm.hibernate4.HibernateTransactionManager"&gt;  

        &lt;property name="sessionFactory"&gt;  

            &lt;ref local="mysqlSessionFactory" /&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

     &lt;!--Mysql hibernate4必须配置为开启事务 否则 getCurrentSession()获取不到--&gt;  

    &lt;bean id="mysqlTransactionInterceptor"  

        class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;  

        &lt;property name="transactionManager"&gt;  

            &lt;ref local="mysqlTransactionManager" /&gt;  

        &lt;/property&gt;  

        &lt;property name="transactionAttributes"&gt;  

            &lt;props&gt;  

                &lt;prop key="register"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="select*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="query*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="sync*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="finish*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="add*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="insert*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="edit*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="update*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="save*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="remove*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="delete*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="modify*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="*"&gt;PROPAGATION_REQUIRED,-java.lang.Exception&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

      
        &lt;!-- 配置oracle事务 --&gt;  

    &lt;bean id="oracleTransactionManager"  

        class="org.springframework.orm.hibernate4.HibernateTransactionManager"&gt;  

        &lt;property name="sessionFactory"&gt;  

            &lt;ref local="oracleSessionFactory" /&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

     &lt;!--Mysql hibernate4必须配置为开启事务 否则 getCurrentSession()获取不到--&gt;  

    &lt;bean id="oracleTransactionInterceptor"  

        class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;  

        &lt;property name="transactionManager"&gt;  

            &lt;ref local="oracleTransactionManager" /&gt;  

        &lt;/property&gt;  

        &lt;property name="transactionAttributes"&gt;  

            &lt;props&gt;  

                &lt;prop key="register"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="select*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="query*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="sync*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="finish*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="add*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="insert*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="edit*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="update*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="save*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="remove*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="delete*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="modify*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="*"&gt;PROPAGATION_REQUIRED,-java.lang.Exception&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

      
    &lt;!-- autoproxy 自动创建代理--&gt;  

      &lt;bean id="ProxyCreator" class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;  

         &lt;property name="beanNames"&gt;  

             &lt;list&gt;  

                &lt;value&gt;*ServiceImpl&lt;/value&gt;  

             &lt;/list&gt;  

         &lt;/property&gt;  

         &lt;property name="interceptorNames"&gt;  

             &lt;list&gt;  

                &lt;value&gt;mysqlTransactionInterceptor&lt;/value&gt;  

                &lt;value&gt;oracleTransactionInterceptor&lt;/value&gt;  

             &lt;/list&gt;  

         &lt;/property&gt;  

      &lt;/bean&gt;  

    &lt;!--********************************注入Mysql Dao*********************************************--&gt;  

    &lt;bean id="mysqlBaseDao" class="edu.njupt.zhb.dao.MysqlBaseDao"&gt;  

        &lt;property name="sessionFactory" ref="mysqlSessionFactory"&gt;&lt;/property&gt;  

    &lt;/bean&gt;  

    &lt;!--********************************注入Oracle Dao*********************************************--&gt;  

    &lt;bean id="oracleBaseDao" class="edu.njupt.zhb.dao.OracleBaseDao"&gt;  

        &lt;property name="sessionFactory" ref="oracleSessionFactory"&gt;&lt;/property&gt;  

    &lt;/bean&gt;  

    &lt;!--********************************注入Services********************************--&gt;  

    &lt;!--********************************注入Action********************************--&gt;  

&lt;/beans&gt;  


优缺点分析：
 
优点：我们能够在程序中正常得使用2个不同的Dao，而且可以调用dao的getSessionFactory().getCurrentSession()，使用起来特别的方便。每个Dao都有自己的事务管理，安全性各方面和一个数据库一样。
缺点：由于事务的配置和自动创建代理的配置，只要有一个数据库连接不了，即便两外一个数据库可以连接，整个项目仍然无法正常启动。对于一些特殊的应用场景，该方案有着很大的缺陷。
比如某项目的需求为：一个项目需要同时操作2个数据库，如果一个数据库无法连接，那么项目就操作另外一个数据库，同时，将操作的动作记录下来，等另外一个数据库可以连接的时候，再将之前的操作同步到这个数据库中。而且要求，当项目启动的时候，即便只有一个数据库可以连接，那么项目仍然要正常运行。
方案2
为了解决上述的需求，我们将其中一个数据库作为本地数据库，另外一个作为远程数据库，当远程数据库无法连接时，我们跳过。整个项目使用本地数据库即可，同时将需要同步的数据，保存起来，待可连接时，再同步。
 



[html] view plaincopy
 





&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;beans xmlns="http://www.springframework.org/schema/beans"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"  

    xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"  

    xsi:schemaLocation="http://www.springframework.org/schema/beans  

    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  
    http://www.springframework.org/schema/tx   
    http://www.springframework.org/schema/tx/spring-tx-3.0.xsd  
    http://www.springframework.org/schema/aop  
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd  
    http://www.springframework.org/schema/context  
    http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;  

    &lt;!-- 引入datasource配置文件 --&gt;  

    &lt;context:property-placeholder location="classpath:datasource.properties" /&gt;  

    &lt;!--创建mysql jdbc数据源 --&gt;  

    &lt;bean id="mysqlDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"  

        destroy-method="close"&gt;  

        &lt;property name="driverClass" value="${jdbc.mysql.driver}" /&gt;  

        &lt;property name="jdbcUrl" value="${jdbc.mysql.url}" /&gt;  

        &lt;property name="user" value="${jdbc.mysql.username}" /&gt;  

        &lt;property name="password" value="${jdbc.mysql.password}" /&gt;  

        &lt;!-- 指定连接数据库连接池的最小连接数 --&gt;  

        &lt;property name="minPoolSize" value="10" /&gt;  

        &lt;!-- 指定连接数据库连接池的最大连接数 --&gt;  

        &lt;property name="maxPoolSize" value="30" /&gt;  

        &lt;!-- 指定连接数据库连接池的连接的最大空闲时间 --&gt;  

        &lt;property name="maxIdleTime" value="1800" /&gt;  

        &lt;property name="acquireIncrement" value="2" /&gt;  

        &lt;property name="maxStatements" value="0" /&gt;  

        &lt;!-- 指定连接数据库连接池的初始化连接数 --&gt;  

        &lt;property name="initialPoolSize" value="2" /&gt;  

        &lt;property name="idleConnectionTestPeriod" value="1800" /&gt;  

        &lt;!-- 当连接失败时，尝试重新连接的次数 --&gt;  

        &lt;property name="acquireRetryAttempts" value="30" /&gt;  

        &lt;property name="breakAfterAcquireFailure" value="true" /&gt;  

        &lt;property name="testConnectionOnCheckout" value="false" /&gt;  

    &lt;/bean&gt;  

    &lt;!--创建oracle jdbc数据源 --&gt;  

    &lt;bean id="oracleDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"  

        destroy-method="close"&gt;  

        &lt;property name="driverClass" value="${jdbc.oracle.driver}" /&gt;  

        &lt;property name="jdbcUrl" value="${jdbc.oracle.url}" /&gt;  

        &lt;property name="user" value="${jdbc.oracle.username}" /&gt;  

        &lt;property name="password" value="${jdbc.oracle.password}" /&gt;  

        &lt;!-- 指定连接数据库连接池的最小连接数 --&gt;  

        &lt;property name="minPoolSize" value="10" /&gt;  

        &lt;!-- 指定连接数据库连接池的最大连接数 --&gt;  

        &lt;property name="maxPoolSize" value="30" /&gt;  

        &lt;!-- 指定连接数据库连接池的连接的最大空闲时间 --&gt;  

        &lt;property name="maxIdleTime" value="1800" /&gt;  

        &lt;property name="acquireIncrement" value="2" /&gt;  

        &lt;property name="maxStatements" value="0" /&gt;  

        &lt;!-- 指定连接数据库连接池的初始化连接数 --&gt;  

        &lt;property name="initialPoolSize" value="2" /&gt;  

        &lt;property name="idleConnectionTestPeriod" value="1800" /&gt;  

        &lt;!-- 当连接失败时，尝试重新连接的次数 --&gt;  

        &lt;property name="acquireRetryAttempts" value="1" /&gt;  

        &lt;property name="breakAfterAcquireFailure" value="true" /&gt;  

        &lt;property name="testConnectionOnCheckout" value="false" /&gt;  

    &lt;/bean&gt;  

    &lt;!-- 创建MysqlSessionFactory--&gt;  

    &lt;bean id="mysqlSessionFactory"  

        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt;  

        &lt;property name="dataSource" ref="mysqlDataSource" /&gt;  

        &lt;property name="hibernateProperties"&gt;  

            &lt;props&gt;  

                &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;  

                &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;  

                &lt;prop key="current_session_context_class"&gt;thread&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

        &lt;property name="mappingResources"&gt;  

            &lt;list&gt;  

                &lt;value&gt;edu/njupt/zhb/model/mysql/Student.hbm.xml&lt;/value&gt;  

            &lt;/list&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

  
    &lt;!-- 创建OracleSessionFactory--&gt;  

    &lt;bean id="oracleSessionFactory"  

        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt;  

        &lt;property name="dataSource" ref="oracleDataSource" /&gt;  

        &lt;property name="hibernateProperties"&gt;  

            &lt;props&gt;  

                &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;  

                &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.OracleDialect&lt;/prop&gt;  

                &lt;prop key="current_session_context_class"&gt;thread&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

        &lt;property name="mappingResources"&gt;  

            &lt;list&gt;  

                &lt;value&gt;edu/njupt/zhb/model/oracle/Student.hbm.xml&lt;/value&gt;  

            &lt;/list&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

      
    &lt;!-- 配置Mysql事务 --&gt;  

    &lt;bean id="mysqlTransactionManager"  

        class="org.springframework.orm.hibernate4.HibernateTransactionManager"&gt;  

        &lt;property name="sessionFactory"&gt;  

            &lt;ref local="mysqlSessionFactory" /&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

     &lt;!--Mysql hibernate4必须配置为开启事务 否则 getCurrentSession()获取不到--&gt;  

    &lt;bean id="mysqlTransactionInterceptor"  

        class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;  

        &lt;property name="transactionManager"&gt;  

            &lt;ref local="mysqlTransactionManager" /&gt;  

        &lt;/property&gt;  

        &lt;property name="transactionAttributes"&gt;  

            &lt;props&gt;  

                &lt;prop key="register"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="select*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="query*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;  

                &lt;prop key="sync*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="finish*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="add*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="insert*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="edit*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="update*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="save*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="remove*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="delete*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="modify*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;  

                &lt;prop key="*"&gt;PROPAGATION_REQUIRED,-java.lang.Exception&lt;/prop&gt;  

            &lt;/props&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

    &lt;!-- autoproxy 自动创建代理--&gt;  

      &lt;bean id="ProxyCreator" class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;  

         &lt;property name="beanNames"&gt;  

             &lt;list&gt;  

                &lt;value&gt;*ServiceImpl&lt;/value&gt;  

             &lt;/list&gt;  

         &lt;/property&gt;  

         &lt;property name="interceptorNames"&gt;  

             &lt;list&gt;  

                &lt;value&gt;mysqlTransactionInterceptor&lt;/value&gt;  

             &lt;/list&gt;  

         &lt;/property&gt;  

      &lt;/bean&gt;  

    &lt;!--********************************注入Mysql Dao*********************************************--&gt;  

    &lt;bean id="mysqlBaseDao" class="edu.njupt.zhb.dao.MysqlBaseDao"&gt;  

        &lt;property name="sessionFactory" ref="mysqlSessionFactory"&gt;&lt;/property&gt;  

    &lt;/bean&gt;  

    &lt;!--********************************注入Oracle Dao*********************************************--&gt;  

    &lt;bean id="oracleBaseDao" class="edu.njupt.zhb.dao.OracleBaseDao"&gt;  

        &lt;property name="sessionFactory" ref="oracleSessionFactory"&gt;&lt;/property&gt;  

    &lt;/bean&gt;  

    &lt;!--********************************注入Services********************************--&gt;  

    &lt;!--********************************注入Action********************************--&gt;  

&lt;/beans&gt;  




这种配置下，oracleBaseDao的数据源的属性：acquireRetryAttempts的值配置为1，即便无法连接，我们也只需要连接一次，不会出现“卡住”的情况。而且，由于oracleBaseDao中，我们没有配置事务，因此，dao无法获得getCurrentSession，只能通过sessionFactory().openSession()来使用Hibernate。同时为了捕获异常，我们将session设置成手动提交的方式。
