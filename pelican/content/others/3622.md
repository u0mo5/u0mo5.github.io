Title: apache服务器本质上说是一个TCP socket服务
Date: 1970-01-01 00:00:00
Modified: 1970-01-01 00:00:00
cat: default
Tags: 
Slug: 3622
Authors: u0mo5 
Summary: 

apache服务器本质上说是一个TCP socket服务，socket模型如下:  下面以worker MPM来说明apache代码中相应处理的位置在哪里： （以apache httpd 2.2.23版本的代码为基础） 1) 在第一次启动时验证配置没有异常时，创建了socket。    2) open_logs 挂钩调用了 ap_setup_listeners() ，最终在listen.c的make_socket方法执行了apr_socket_bind/apr_socket_listen，进入通信的环节。    3) worker.c的监听线程中负责接受请求，然后利用ap_queue_push把相应的请求放入队列中。下面是接受请求accept_func的调用栈。  4)请求/响应的处理。 请求的处理是通过handler来实现，如果是读取服务器上的静态页面，则由default_handler来处理。同时响应的内容需要通过filter修改之后，最终发送header和body。下面是发送header的调用栈。  暂时写到这里，以后再继续分析。
