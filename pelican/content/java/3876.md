Title: Spring任务调度实战之Quartz Cron Trigger
Date: 1970-01-01 00:00:00
Modified: 1970-01-01 00:00:00
cat: default
Tags: 
Slug: 3876
Authors: u0mo5 
Summary: 

在Quartz中除了使用最简单的Simple Trigger以外，也可以使用类似Linux上Cron作业的CronTrigger的方式来运行Job，下面是一个小例子：
1. 首先是一个任务类，这个类没有实现任何接口，其中包含一个run方法用来运行这个task，代码如下：
 



[java] view plaincopyprint?
 



package org.garbagecan.springstudy.schedule.quartz;  
  
public class MyTask {  
    private String name;  

      
    public void run() {  

        System.out.println("Run task: " + name + ".");  

    }  
  
    public String getName() {  

        return name;  

    }  
  
    public void setName(String name) {  

        this.name = name;  

    }  
}  


2. 一个Job类，这个类需要继承spring的QuartzJobBean类，来说明当前类是一个Quartz的Job类，类包含了一个Task类的对象实例，在每次Job被调度的时候，将会运行其中的executeInternal方法，代码如下：
 
 



[java] view plaincopyprint?
 



package org.garbagecan.springstudy.schedule.quartz;  
  
import org.quartz.JobExecutionContext;  
import org.quartz.JobExecutionException;  
import org.springframework.scheduling.quartz.QuartzJobBean;  
  
public class MyJob extends QuartzJobBean {  
      
    private MyTask myTask;  

  
    protected void executeInternal(JobExecutionContext context)  

            throws JobExecutionException {  

          
        myTask.run();  
    }  
  
    public MyTask getMyTask() {  

        return myTask;  

    }  
  
    public void setMyTask(MyTask myTask) {  

        this.myTask = myTask;  

    }  
}  


3. Spring配置文件，内容如下
 
 



[html] view plaincopyprint?
 



&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;beans xmlns="http://www.springframework.org/schema/beans"  
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  

       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"  

       default-lazy-init="true"&gt;  

  
    &lt;bean id="timerFactory" class="org.springframework.scheduling.quartz.SchedulerFactoryBean" lazy-init="false"&gt;  

        &lt;property name="triggers"&gt;  

            &lt;list&gt;  

                &lt;ref local=""cronTrigger""/&gt;  

            &lt;/list&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

  
    &lt;bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean"&gt;  

        &lt;property name="jobDetail" ref="myJob"/&gt;  

        &lt;property name="cronExpression" value="0/10 * * * * ?"&gt;&lt;/property&gt;  

    &lt;/bean&gt;  

      
    &lt;bean id="myJob" class="org.springframework.scheduling.quartz.JobDetailBean"&gt;  

        &lt;property name="name" value="myJob"/&gt;  

        &lt;property name="group" value="myGroup"/&gt;  

        &lt;property name="description" value="myJob"/&gt;  

        &lt;property name="jobClass" value="org.garbagecan.springstudy.schedule.quartz.MyJob"/&gt;  

        &lt;property name="jobDataAsMap"&gt;  

            &lt;map&gt;  

                &lt;entry key="myTask" value-ref="myTask" /&gt;  

            &lt;/map&gt;  

        &lt;/property&gt;  

    &lt;/bean&gt;  

      
    &lt;bean id="myTask" class="org.garbagecan.springstudy.schedule.quartz.MyTask"&gt;  

        &lt;property name="name" value="my task"/&gt;  

    &lt;/bean&gt;  

      
&lt;/beans&gt;  


3.1 首先，需要定义了一个Task类，具体的任务逻辑可以写在这个类里；3.2 定义一个JobDetailBean类的bean，这个是为了适应Quartz的JobDetail，其中可以定义name，group，description等信息，这些信息主要是为了和别的作业做区分使用；其中还有一个jobClass属性，定义了使用的是那个Job类实例，这里使用第二步创建的MyJob类；最后定义了一个叫jobDataAsMap的属性，这个属性是Quartz提供的用来传递参数使用的一个Map集合，这些集合里的类会被spring自动注入到目标Job类中；3.3 创建一个触发器类，这里使用的是Quartz提供的Cron Trigger，在Spring里，使用的是CronTriggerBean来做映射，主要是定义cron表达式，具体可以参考quartz的官方文档，这里定义的是每隔10秒运行一次；当然还有最主要的具体的Job类实例；3.4 最后定义了一个SchedulerFactoryBean的bean，其中定义了具体要调度那些触发器；
 
4. 最后，写一个测试类来测试上面的代码和配置
 



[java] view plaincopyprint?
 





package org.garbagecan.springstudy.schedule.quartz;  
  
import org.springframework.context.support.ClassPathXmlApplicationContext;  
  
public class Test {  
    public static void main(String[] args) throws Exception {  

        new ClassPathXmlApplicationContext("/org/garbagecan/springstudy/schedule/quartz/spring.xml");  

    }  
}  




运行Test类，可以看到一个叫my task的job会启动，并且每隔10秒运行一次。
 
 
