Title: Windows下ARP协议的工作原理简介
Date: 1970-01-01 00:00:00
Modified: 1970-01-01 00:00:00
cat: windows
Tags: 
Slug: 3610
Authors: u0mo5 
Summary: 

   ARP协议（Address Resolve Protocol，地址解析协议）工作在TCP/IP协议的第二层－数据链路层，用于将IP地址转换为网络接口的硬件地址（媒体访问控制地址，即MAC地址）。无论是任何高层协议的通讯，最终都将转换为数据链路层硬件地址的通讯。
    每台主机都具有一个用于缓存MAC地址的ARP缓存列表，你可以使用命令ARP -a或ARP -g来查看当前的ARP缓存列表。此ARP缓存列表是动态更新的，默认情况下，当其中的缓存项超过两分钟没有活动时，此缓存项就会超时被删除。你可以使用 ARP -s来静态绑定IP地址和MAC地址，不过在Windows server 2003和XP以前的Windows系统中，就算你设置了静态MAC地址绑定项，同样会通过接收其他主机的数据包而更新已经绑定的项。
Windows server 2003和XP中，静态绑定的项不会被动态更新，直到TCP/IP协议终止为止，例如重启计算机。如果要创建永久的静态MAC地址绑定项，你可以写一个脚本文件来执行ARP静态绑定，然后使用计划任务在启动计算机时执行该脚本即可。
    举例说明工作原理
    例如A主机的IP地址为192.168.0.1，它现在需要与IP为192.168.0.8的主机（主机B）进行通讯，那么将进行以下动作：
A主机查询自己的ARP缓存列表， 如果发现具有对应于目的IP地址192.168.0.8的MAC地址项，则直接使用此MAC地址项构造并发送以太网数据包，如果没有发现对应的MAC地址项则继续下一步；
A主机发出ARP解析请求广播，目的MAC地址是FF:FF:FF:FF:FF:FF，请求IP为192.168.0.8的主机回复MAC地址；
B主机收到ARP解析请求广播后，回复给A主机一个ARP应答数据包，其中包含自己的IP地址和MAC地址；
A接收到B主机的ARP回复后，将B主机的MAC地址放入自己的ARP缓存列表，然后使用B主机的MAC地址作为目的MAC地址，B主机的IP地址（192.168.0.8）作为目的IP地址， 构造并发送以太网数据包；
如果A主机还要发送数据包给192.168.0.8， 由于在ARP缓存列表中已经具有IP地址192.168.0.8的MAC地址，所以A主机直接使用此MAC地址发送数据包，而不再发送ARP解析请求广播；当此缓存地址项超过两分钟没有活动（没有使用）后，此ARP缓存将超时被删除。
    ARP命令来绑定IP和MAC地址
     ARP命令来绑定IP和MAC地址格式为：ARP -s IP MAC
例如：ARP -s 192.168.0.8 00-0D-60-C3-05-34
