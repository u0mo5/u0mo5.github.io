<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>SSH框架系列：Spring AOP应用记录日志Demo</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/blog/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/pygment.css" />

        <script src="/blog/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/blog/">逍遥の博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/blog/">首页</a></li>


              </ul>

            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/blog/3921.html" rel="bookmark"
                   title="Permalink to SSH框架系列：Spring AOP应用记录日志Demo">SSH框架系列：Spring AOP应用记录日志Demo</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                周四 01 一月 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/blog/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>分类： 【java】2013-12-10 18:53 724人阅读 评论(0) 收藏 举报</p>
<p>1.简介
Spring 中的AOP为Aspect Oriented Programming的缩写，面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。以下是Spring AOP的小例子
源代码：https://github.com/nuptboyzhb/SpringAOPDemo</p>
<p>2.例子简介
2.1切面aspect：Logging.java</p>
<p>[java] view plaincopy
 </p>
<p>/<em> 
 </em> $filename: Logging.java,v $ 
 <em> $Date: 2013-12-10  $ 
 </em> Copyright (C) ZhengHaibo, Inc. All rights reserved. 
 <em> This software is Made by Zhenghaibo. 
 </em>/  
package edu.njupt.zhb;  
/<em> 
 </em>@author: ZhengHaibo   
 <em>web:     http://blog.csdn.net/nuptboyzhb 
 </em>mail:    zhb931706659@126.com 
 <em>2013-12-10  Nanjing,njupt,China 
 </em>/  
public class Logging {  
      
    public void beforeAdvice(){  </p>
<p>System.out.println("Logging:before... ");  </p>
<p>}  
      
    public void afterAdvice(){  </p>
<p>System.out.println("Logging:after... ");  </p>
<p>}  
    /** </p>
<p><em>  
     </em> @param retVal 函数的返回值 
     */  
    public void afterReturningAdvice(Object retVal){  </p>
<p>if(retVal==null){  </p>
<p>return;  </p>
<p>}  
        System.out.println("Logging:return :"+retVal.toString());  </p>
<p>}  
      
    public void afterThrowingAdvice(IllegalArgumentException ex){  </p>
<p>System.out.println("Logging:exception:"+ex.toString());  </p>
<p>}  
}  </p>
<p>2.2Bean: Student.java</p>
<p>[java] view plaincopy
 </p>
<p>/<em> 
 </em> $filename: Student.java,v $ 
 <em> $Date: 2013-12-10  $ 
 </em> Copyright (C) ZhengHaibo, Inc. All rights reserved. 
 <em> This software is Made by Zhenghaibo. 
 </em>/  
package edu.njupt.zhb;  
/<em> 
 </em>@author: ZhengHaibo   
 <em>web:     http://blog.csdn.net/nuptboyzhb 
 </em>mail:    zhb931706659@126.com 
 <em>2013-12-10  Nanjing,njupt,China 
 </em>/  
public class Student {  
    private String id;  </p>
<p>private String name;  </p>
<p>public String getId() {  </p>
<p>return id;  </p>
<p>}  
    public void setId(String id) {  </p>
<p>this.id = id;  </p>
<p>}  
    public String getName() {  </p>
<p>return name;  </p>
<p>}  
    public void setName(String name) {  </p>
<p>this.name = name;  </p>
<p>}  
    public void printThrowException(){  </p>
<p>System.out.println("Exception in Student.class...");  </p>
<p>throw new IllegalArgumentException("Exception from Student...");  </p>
<p>}  
    public void print(String say){  </p>
<p>System.out.println("Say:"+say+",Name = "+name);  </p>
<p>}  
}  </p>
<p>2.3xml文件配置</p>
<p>[html] view plaincopy
 </p>
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;beans xmlns="http://www.springframework.org/schema/beans"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   </p>
<p>xmlns:p="http://www.springframework.org/schema/p"  </p>
<p>xmlns:aop="http://www.springframework.org/schema/aop"  </p>
<p>xsi:schemaLocation="http://www.springframework.org/schema/beans   </p>
<p>http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  
    http://www.springframework.org/schema/aop   
    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;  </p>
<p>&lt;!-- 切面类 --&gt;  </p>
<p>&lt;bean id="myLogging" class="edu.njupt.zhb.Logging"&gt;&lt;/bean&gt;  </p>
<p>&lt;!-- AOP配置 --&gt;  </p>
<p>&lt;aop:config&gt;  </p>
<p>&lt;aop:aspect id="logStudent" ref="myLogging"&gt;  </p>
<p>&lt;!-- pointcut配置 --&gt;  </p>
<p>&lt;aop:pointcut id="allMethod" expression="execution(<em> edu.njupt.zhb.</em>.*(..))"/&gt;  </p>
<p>&lt;aop:before pointcut-ref="allMethod" method="beforeAdvice"/&gt;  </p>
<p>&lt;aop:after  pointcut-ref="allMethod" method="afterAdvice"/&gt;  </p>
<p>&lt;aop:after-returning pointcut-ref="allMethod" returning="retVal" method="afterReturningAdvice"/&gt;  </p>
<p>&lt;aop:after-throwing pointcut-ref="allMethod" throwing="ex" method="afterThrowingAdvice"/&gt;  </p>
<p>&lt;/aop:aspect&gt;  </p>
<p>&lt;/aop:config&gt;  </p>
<p>&lt;bean id="student" class="edu.njupt.zhb.Student"&gt;  </p>
<p>&lt;property name="id" value="1012010638"&gt;&lt;/property&gt;  </p>
<p>&lt;property name="name" value="Haibo Zheng"&gt;&lt;/property&gt;  </p>
<p>&lt;/bean&gt;  </p>
<p>&lt;/beans&gt;  </p>
<p>2.4测试</p>
<p>[java] view plaincopy
 </p>
<p>package edu.njupt.zhb;  
/<em> 
 </em> $filename: TestMain.java,v $ 
 <em> $Date: 2013-12-10  $ 
 </em> Copyright (C) ZhengHaibo, Inc. All rights reserved. 
 <em> This software is Made by Zhenghaibo. 
 </em>/  
  
  
import org.springframework.context.ApplicationContext;  
import org.springframework.context.support.ClassPathXmlApplicationContext;  
  
  
/<em> 
 </em>@author: ZhengHaibo   
 <em>web:     http://blog.csdn.net/nuptboyzhb 
 </em>mail:    zhb931706659@126.com 
 <em>2013-12-10  Nanjing,njupt,China 
 </em>/  
public class TestMain {  
  
    /** </p>
<p><em> @param args 
     </em>/  
    public static void main(String[] args) {  </p>
<p>// TODO Auto-generated method stub  </p>
<p>ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");  </p>
<p>Student student = (Student)context.getBean("student");  </p>
<p>System.out.println("-------------");  </p>
<p>student.getId();  
        System.out.println("-------------");  </p>
<p>student.getName();  
        System.out.println("-------------");  </p>
<p>student.print("Hi,I am a student");  </p>
<p>System.out.println("-------------");  </p>
<p>try{  </p>
<p>student.printThrowException();  
        }catch (Exception e) {  </p>
<p>// TODO: handle exception  </p>
<p>System.out.println(e.getMessage());  
        }  
          
    }  
  
}  </p>
<p>2.5运行结果：</p>
<p>[plain] view plaincopy
 </p>
<p>2013-12-10 18:32:54 org.springframework.context.support.AbstractApplicationContext prepareRefresh  
信息: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@145e044: display name [org.springframework.context.support.ClassPathXmlApplicationContext@145e044]; startup date [Tue Dec 10 18:32:54 CST 2013]; root of context hierarchy  
2013-12-10 18:32:54 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions  
信息: Loading XML bean definitions from class path resource [applicationContext.xml]  
2013-12-10 18:32:54 org.springframework.context.support.AbstractApplicationContext obtainFreshBeanFactory  
信息: Bean factory for application context [org.springframework.context.support.ClassPathXmlApplicationContext@145e044]: org.springframework.beans.factory.support.DefaultListableBeanFactory@1f4cbee  
2013-12-10 18:32:54 org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons  
信息: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@1f4cbee: defining beans [myLogging,org.springframework.aop.config.internalAutoProxyCreator,org.springframework.aop.aspectj.AspectJPointcutAdvisor#0,org.springframework.aop.aspectj.AspectJPointcutAdvisor#1,org.springframework.aop.aspectj.AspectJPointcutAdvisor#2,org.springframework.aop.aspectj.AspectJPointcutAdvisor#3,allMethod,student]; root of factory hierarchy  
-------------  
Logging:before...   
Logging:after...   
Logging:return :1012010638  
-------------  
Logging:before...   
Logging:after...   
Logging:return :Haibo Zheng  
-------------  
Logging:before...   
Say:Hi,I am a student,Name = Haibo Zheng  
Logging:after...   
-------------  
Logging:before...   
Exception in Student.class...  
Logging:after...   
Logging:exception:java.lang.IllegalArgumentException: Exception from Student...  
Exception from Student...  </p>
<p>上述的方法只是在执行函数前，加一些自己的逻辑。如果完成更加复杂的功能，我们可能需要知道函数的名称以及函数的参数及其值等等信息。此时，我们只需要修改Logging类即可，可以修改为如下：（主要是使用了Spring aop中的JointPoint）</p>
<p>[java] view plaincopy
 </p>
<p>/<em> 
 </em> $filename: Logging.java,v $ 
 <em> $Date: 2013-12-10  $ 
 </em> Copyright (C) ZhengHaibo, Inc. All rights reserved. 
 <em> This software is Made by Zhenghaibo. 
 </em>/  
package edu.njupt.zhb;  
  
import org.aspectj.lang.JoinPoint;  
  
/<em> 
 </em>@author: ZhengHaibo   
 <em>web:     http://blog.csdn.net/nuptboyzhb 
 </em>mail:    zhb931706659@126.com 
 <em>2013-12-10  Nanjing,njupt,China 
 </em>/  
public class Logging {  
      
    public void beforeAdvice(JoinPoint jointPoint){  </p>
<p>Object methodArgs[] = jointPoint.getArgs();//获取切入点函数的参数  </p>
<p>for(Object arg:methodArgs){  </p>
<p>System.out.println("Logging:args type="+arg.getClass().getName());  </p>
<p>System.out.println("Logging:args value="+arg);  </p>
<p>}  
        System.out.println("Logging:ClassName="+jointPoint.getTarget().getClass().getName());  </p>
<p>System.out.println("Logging:MethodName="+jointPoint.getSignature().getName());  </p>
<p>System.out.println("Logging:before... ");  </p>
<p>}  
      
    public void afterAdvice(){  </p>
<p>System.out.println("Logging:after... ");  </p>
<p>}  
    /** </p>
<p><em>  
     </em> @param retVal 函数的返回值 
     */  
    public void afterReturningAdvice(Object retVal){  </p>
<p>if(retVal==null){  </p>
<p>return;  </p>
<p>}  
        System.out.println("Logging:return :"+retVal.toString());  </p>
<p>}  
      
    public void afterThrowingAdvice(IllegalArgumentException ex){  </p>
<p>System.out.println("Logging:exception:"+ex.toString());  </p>
<p>}  
}  </p>
<p>此时的运行结果为：
 </p>
<p>[java] view plaincopy
 </p>
<p>2013-12-10 19:44:07 org.springframework.context.support.AbstractApplicationContext prepareRefresh  
信息: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@145e044: display name [org.springframework.context.support.ClassPathXmlApplicationContext@145e044]; startup date [Tue Dec 10 19:44:07 CST 2013]; root of context hierarchy  </p>
<p>2013-12-10 19:44:07 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions  
信息: Loading XML bean definitions from class path resource [applicationContext.xml]  </p>
<p>2013-12-10 19:44:07 org.springframework.context.support.AbstractApplicationContext obtainFreshBeanFactory  
信息: Bean factory for application context [org.springframework.context.support.ClassPathXmlApplicationContext@145e044]: org.springframework.beans.factory.support.DefaultListableBeanFactory@787d6a  </p>
<p>2013-12-10 19:44:07 org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons  
信息: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@787d6a: defining beans [myLogging,org.springframework.aop.config.internalAutoProxyCreator,org.springframework.aop.aspectj.AspectJPointcutAdvisor#0,org.springframework.aop.aspectj.AspectJPointcutAdvisor#1,org.springframework.aop.aspectj.AspectJPointcutAdvisor#2,org.springframework.aop.aspectj.AspectJPointcutAdvisor#3,allMethod,student]; root of factory hierarchy  </p>
<p>-------------  
Logging:ClassName=edu.njupt.zhb.Student  
Logging:MethodName=getId  
Logging:before...   
Logging:after...   
Logging:return :1012010638  </p>
<p>-------------  
Logging:ClassName=edu.njupt.zhb.Student  
Logging:MethodName=getName  
Logging:before...   
Logging:after...   
Logging:return :Haibo Zheng  </p>
<p>-------------  
Logging:args type=java.lang.String  
Logging:args value=Hi,I am a student  
Logging:args type=java.lang.Integer  
Logging:args value=20  </p>
<p>Logging:ClassName=edu.njupt.zhb.Student  
Logging:MethodName=print  
Logging:before...   
Say:Hi,I am a student,Name = Haibo Zheng,age = 20  </p>
<p>Logging:after...   
-------------  
Logging:ClassName=edu.njupt.zhb.Student  
Logging:MethodName=printThrowException  
Logging:before...   
Exception in Student.class...  </p>
<p>Logging:after...   
Logging:exception:java.lang.IllegalArgumentException: Exception from Student...  
Exception from Student...  </p>
<p>未经允许，不得用于商业目的</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">
<h4>站内搜索</h4>
              <div class="navbar-search pull-right">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=8305292233022102519' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
              </div>    

<h4>页面</h4>

 <ul>
  </ul>

<h4>分类</h4>
<ul class="blank">
		<li><a href="/blog/category/android.html">android</a></li>
		<li><a href="/blog/category/api.html">api</a></li>
		<li><a href="/blog/category/essay.html">essay</a></li>
		<li><a href="/blog/category/git.html">git</a></li>
		<li><a href="/blog/category/go.html">go</a></li>
		<li><a href="/blog/category/hack.html">hack</a></li>
		<li><a href="/blog/category/ios.html">ios</a></li>
		<li><a href="/blog/category/java.html">java</a></li>
		<li><a href="/blog/category/javascript.html">javascript</a></li>
		<li><a href="/blog/category/linux.html">linux</a></li>
		<li><a href="/blog/category/mysql.html">mysql</a></li>
		<li><a href="/blog/category/operation.html">operation</a></li>
		<li><a href="/blog/category/others.html">others</a></li>
		<li><a href="/blog/category/php.html">php</a></li>
		<li><a href="/blog/category/program.html">program</a></li>
		<li><a href="/blog/category/python.html">python</a></li>
		<li><a href="/blog/category/read.html">read</a></li>
		<li><a href="/blog/category/soft.html">soft</a></li>
		<li><a href="/blog/category/success.html">success</a></li>
		<li><a href="/blog/category/test.html">test</a></li>
		<li><a href="/blog/category/vcs.html">vcs</a></li>
		<li><a href="/blog/category/windows.html">windows</a></li>
</ul>


<h4>标签</h4>


<nav class="widget">
  <h4>友情链接</h4>
  <ul class="blank">
    <li><a href="/">搜索</a></li>
    <li><a href="/123">导航</a></li>
    <li><a href="/doc">文档</a></li>
    <li><a href="/blog">博客</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/blog/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/blog/theme/js/libs/gumby.min.js"></script>
  <script src="/blog/theme/js/plugins.js"></script>
</body>
</html>