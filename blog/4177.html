<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>[SHELL进阶] （转）最牛B的 Linux Shell 命令 （二）</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/blog/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/pygment.css" />

        <script src="/blog/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/blog/">逍遥の博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/blog/">首页</a></li>


              </ul>

            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/blog/4177.html" rel="bookmark"
                   title="Permalink to [SHELL进阶] （转）最牛B的 Linux Shell 命令 （二）">[SHELL进阶] （转）最牛B的 Linux Shell 命令 （二）</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                Thu 01 January 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/blog/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>1.用你最喜欢的编辑器来敲命令</p>
<p>command &lt;CTRL-x CTRL-e&gt;</p>
<p>在已经敲完的命令后按 &lt;CTRL-x CTRL-e&gt; ，会打开一个你指定的编辑器（比如vim，通过环境变量$EDITOR指定），里面就是你刚输入的命令，然后爱怎么编辑就怎么编辑吧，特别是那些参数异常复杂的程序，比如mencoder/ffmpeg，一个命令动辄3、4行的，要修改其中的参数，这个方法最合适不过了，保存退出后自动执行这个程序。
实际上这是readline库的功能，在默认情况下，bash使用的是emacs模式的命令行操作方式， &lt;CTRL-x CTRL-e&gt;是调用这个功能的一个绑定。如果你习惯使用vi模式，按 &lt;ESC v&gt; 可以实现同样功能。
如果你喜欢别的编辑器，可以在~/.bashrc里面放上比如export EDITOR=nano的命令。
另外一个修改命令的方法是使用fc命令（Fix Command），在编辑器里面打开上一句命令。我们的第一辑连载提过一个^foo^bar^命令可以用fc来实现：fc -s foo=bar。
2.清空或创建一个文件</p>
<p>&gt; file.txt</p>
<p>&gt;在shell里面是标准输出重定向符，即把（前部个命令的）命令行输出转往一个文件内，但这里没有&quot;前部命令&quot;，输出为空，于是就覆盖（或创建）成一个空文件了。
有些脚本的写法是:&gt;file.txt，因为:是bash默认存在的空函数。
单纯创建文件也可以用$touch file.txt，touch本来是用作修改文件的时间戳，但如果文件不存在，就自动创建了。
3.用SSH创建端口转发通道</p>
<p>ssh -N -L2001:remotehost:80 user@somemachine</p>
<p>这个命令在本机打开了2001端口，对本机2001端口的请求通过somemachine作为跳板，转到remotehost的80端口上。
实现效果跟术语反向代理是相似的，实际上就是端口转发，注意上面的描述涉及了3台主机，但当然somemachine可以变成localhost。
这个命令比较抽象，但有时候是很有用的，比如因为众所周知的原因国内的IP的80端口无法使用，又或者公司的防火墙只给外网开了ssh端口，需要访问内部服务器一个web应用，以及需要访问某些限定了来源IP的服务，就可以用上这个方法了。
举一个具体例子，运行：</p>
<p>ssh -f -N -L 0.0.0.0:443:twitter.com:443 shell.cjb.net
ssh -f -N -L 0.0.0.0:80:twitter.com:80 shell.cjb.net</p>
<p>然后在/etc/hosts里面添加127.0.0.1 twitter.com，好吧剩下的你懂的。
当然通常做这个功能的反向代理，应该要用squid、nginx之类，ssh就算是轻量级的尝试吧！
4.重置终端</p>
<p>reset</p>
<p>如果你试过不小心cat了某个二进制文件，很可能整个终端就傻掉了，可能不会换行，没法回显，大堆乱码之类的，这时候敲入reset回车，不管命令有没有显示，就能回复正常了。
实际上reset命令只是输出了一些特殊字符，我们看BusyBox里面最简单的reset程序的实现：
printf(&quot;33c33(K33[J33[0m33[?25h&quot;);
输出的这些字符对Shell是有特殊意义的：</p>
<p>33c: &quot;ESC c&quot; - 发送重置命令;
33(K: &quot;ESC ( K&quot; - 重载终端的字符映射;
33[J: &quot;ESC [ J&quot; - 清空终端内容;
33[0m: &quot;ESC [ 0 m&quot; - 初始化字符显示属性;
33[?25h: &quot;ESC [ ? 25 h&quot; - 让光标可见;</p>
<p>其中字符显示属性经常用来设定打印字符的颜色等，可参考这个博文。
5.在午夜的时候执行某命令</p>
<p>echo cmd | at midnight</p>
<p>说的就是at这个组件，通常跟cron相提并论，不过at主要用于定时一次性任务，而cron定时周期性任务。
at的参数比较人性化，跟英语语法一样，可以tomorrow, next week之类的，详细的查看手册man at。
6.远程传送麦克风语音</p>
<p>dd if=/dev/dsp | ssh username@host dd of=/dev/dsp</p>
<p>没错就是实现一个喊话器的功能。
/dev/dsp是Linux下声卡的文件映射（Digital Signal Proccessor），从其中读数据就是录音，往里面写数据就是播放，相当简单！
dd是常用的数据拷贝程序，如果不同时指定if、of，就直接使用stdin/stdout来传输。
如果你没有远程主机，可以试试这样：</p>
<p>dd if=/dev/dsp of=/dev/dsp</p>
<p>直接回放麦克风的声音，只是有一点延时。
但是如果有别的程序正在使用声卡，这个方法就不凑效了，因为一般的声卡都不允许多个音频流同时处理，可以借用alsa组件的工具，arecord跟aplay:</p>
<p>arecord | ssh username@host aplay</p>
<p>本地回放就是：</p>
<p>arecord | aplay</p>
<p>如果你想吓吓别人：</p>
<p>cat /dev/urandom | ssh username@host aplay</p>
<p>7.映射一个内存目录</p>
<p>mount -t tmpfs -o size=1024m tmpfs /mnt/ram</p>
<p>这个命令开了一块1G内存来当目录用。不过放心，如果里面没文件，是不会占用内存的，用多少占多少。
不过一般来说没必要手动挂载，因为多数发行版都会在fstab内预留了一个内存目录，挂载在/dev/shm，直接使用即可；
最常见的用途是用内存空间来放Firefox的配置，可以让慢吞吞的FF快很多，参见Shellex的博文：用tmpfs让Firefox在内存中飞驰，以及后来的改进：用tmpfs让Firefox在内存中飞驰II，其中提到的脚本来自speeding up firefox with tmpfs and automatic rsync。
那个破烂LinuxQQ也可以用这个方法，减少因为大量磁盘IO导致的问题。
8.用DIFF对比远程文件跟本地文件</p>
<p>ssh user@host cat /path/to/remotefile | diff /path/to/localfile -</p>
<p>diff通常的用法是从参数读入两个文件，而命令里面的-则是指从stdin读入了。
善用ssh可以让web开发减少很多繁琐，还有比如sshfs，可以从编辑-上传-编辑-上传的人工循环里面解脱出来。
9.查看系统中占用端口的进程</p>
<p>netstat -tulnp</p>
<p>Netstat是很常用的用来查看Linux网络系统的工具之一，这个参数可以背下来：
-t: 显示TCP链接信息
-u: 显示UDP链接信息
-l: 显示监听状态的端口
-n: 直接显示ip，不做名称转换
-p: 显示相应的进程PID以及名称（要root权限）
如果要查看关于sockets更详细占用信息等，可以使用lsof工具。</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">
<h4>站内搜索</h4>
              <div class="navbar-search pull-right">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=8305292233022102519' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
              </div>    

<h4>页面</h4>

 <ul>
  </ul>

<h4>分类</h4>
<ul class="blank">
		<li><a href="/blog/category/android.html">android</a></li>
		<li><a href="/blog/category/api.html">api</a></li>
		<li><a href="/blog/category/essay.html">essay</a></li>
		<li><a href="/blog/category/git.html">git</a></li>
		<li><a href="/blog/category/go.html">go</a></li>
		<li><a href="/blog/category/hack.html">hack</a></li>
		<li><a href="/blog/category/ios.html">ios</a></li>
		<li><a href="/blog/category/java.html">java</a></li>
		<li><a href="/blog/category/javascript.html">javascript</a></li>
		<li><a href="/blog/category/linux.html">linux</a></li>
		<li><a href="/blog/category/mysql.html">mysql</a></li>
		<li><a href="/blog/category/operation.html">operation</a></li>
		<li><a href="/blog/category/others.html">others</a></li>
		<li><a href="/blog/category/php.html">php</a></li>
		<li><a href="/blog/category/program.html">program</a></li>
		<li><a href="/blog/category/python.html">python</a></li>
		<li><a href="/blog/category/read.html">read</a></li>
		<li><a href="/blog/category/soft.html">soft</a></li>
		<li><a href="/blog/category/success.html">success</a></li>
		<li><a href="/blog/category/test.html">test</a></li>
		<li><a href="/blog/category/vcs.html">vcs</a></li>
		<li><a href="/blog/category/windows.html">windows</a></li>
</ul>


<h4>标签</h4>


<nav class="widget">
  <h4>友情链接</h4>
  <ul class="blank">
    <li><a href="/">搜索</a></li>
    <li><a href="/123">导航</a></li>
    <li><a href="/doc">文档</a></li>
    <li><a href="/blog">博客</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/blog/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/blog/theme/js/libs/gumby.min.js"></script>
  <script src="/blog/theme/js/plugins.js"></script>
</body>
</html>