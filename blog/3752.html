<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>关于编写Java程序让Jvm崩溃</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/blog/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/pygment.css" />

        <script src="/blog/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/blog/">逍遥の博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/blog/">首页</a></li>


              </ul>

            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/blog/3752.html" rel="bookmark"
                   title="Permalink to 关于编写Java程序让Jvm崩溃">关于编写Java程序让Jvm崩溃</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                周四 01 一月 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/blog/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>今天在书上看到一个作者提出一个问题"怎样通过编写Java代码让Jvm崩溃",我看了之后也不懂。带着问题查了一下，百度知道里面有这样一个答案：
　　1 package jvm;
　　2
　　3 public class Crash {
　　4     public static void main（String[] args） {
　　5
　　6         //Object[] o = {"abc"};初始值赋值，不会有影响。
　　7         Object[] o = null;
　　8
　　9         while （true） {
　　10             o = new Object[] { o };
　　11             //输出的话，jvm就不会崩溃。
　　12             //System.out.println（o）；
　　13         }
　　14     }
　　15 }
　　程序运行十几秒之后，控制台会出现这样的错误：
　　Exception in thread "main" java.lang.OutOfMemoryError: Java heap space
　　at jvm.Crash.main（Crash.java:10）
　　很明显，超出内存空间错误。
　　我将原程序随意改了一下，如赋初始值等，对程序无影响。
　　可是我将死循环中的o输出在控制台的时候，jvm居然一直都不崩，为什么输出的话，就不会超出内存空间呢？
　　我看来，原程序能够使Jvm崩溃，是因为死循环中，通过旧对象，不断创建出新的对象，即创造的对象是互相引用的，所以GC是不会回收它们的，造成堆栈溢出。
　　仿照这个例子，我写了一个简单的类，模仿例子程序中的数组，如下：
　　1 package jvm;
　　2
　　3 public class JvmBean {
　　4
　　5     JvmBean bean = new JvmBean（this）；
　　6
　　7     public JvmBean（JvmBean bean）{
　　8         this.bean = bean;
　　9     }
　　10 }
　　然后简单测试，如下：
　　1 package jvm;
　　2
　　3 public class MyCrash {
　　4
　　5     public static void main（String[] args） {
　　6         JvmBean j = null;
　　7         while（true）{
　　8             j = new JvmBean（j）；
　　9             //无论输出不输出，jvm都会崩溃
　　10             //System.out.println（j）；
　　11         }
　　12     }
　　13 }
　　结果便是控制台输出如下的错误：
　　Exception in thread "main" java.lang.StackOverflowError
　　at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）
　　at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）
　　at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）
　　at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）
　　at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）
　　一长串的"at jvm.JvmBean.&lt;init&gt;（JvmBean.java:5）",后面的被我省略了。
　　结果看来，同样也造成了jvm崩溃，可是错误类型跟例子程序的不同，说堆栈溢出错误，并且无论是否输出，错误都一样发生，为什么呢？
　　由于评论的两位老兄的热心指点，两个问题都水落石出了！
　　这里过一下整个流程。
　　第一个异常 结合天添老兄说的，Exception in thread "main" java.lang.OutOfMemoryError: Java heap space at jvm.Crash.main（Crash.java:10）是因为程序无法申请到足够的内存的时候抛出的异常，Object数组o不断指向新的Object数组，数组元素是原来的Object数组，这使得Object维数越来越高。不断申请内存空间，最终导致超出jvm中堆的最大值。堆内存溢出。为什么输出打印，时间会延长呢？yahokuma老兄一言惊醒梦中人！输出打印的话，虚拟机并不是不会崩溃，而是崩溃的时间大大延长了。而崩溃时间延长其实是假象，是因为输出属于IO事件，每次输出CPU都被中断，IO很耗时，所以，感觉上才会时间延长。
　　第二个异常，yahokuma 老兄在下面评论中已经说的很清楚了，我这里搬过来--"类内部的静态属性 &gt; 静态块 &gt; 对象属性 &gt; 构造方法。注意这一点，那就是说 bean属性会先于JvmBean的构造函数被初始化。在你main函数中，new一个 JvmBean的构造函数之前，类内部的JvmBean对象要优先被初始化，这个类内部的属性bean的内部同样也包含了一个JvmBean对象需要被初始化，成循环调用，造 成了栈溢出。"所以异常才会是这个--Exception in thread "main" java.lang.StackOverflowError
　　我把原JvmBean改一下
　　1 package jvm;
　　2
　　3 public class JvmBean {
　　4
　　5     JvmBean bean = null;
　　6
　　7     public JvmBean（JvmBean bean）{
　　8         this.bean = bean;
　　9     }
　　10 }
　　这样最终得到的结果跟第一个例子一样了。
　　如何使Jvm崩溃呢？如果想使它堆内存空间不足，造成典型的内存泄漏，可以创建对象，使它们不断向深层次引用。产生Exception in thread "main" java.lang.OutOfMemoryError: Java heap space 这样的错误。如果想使他们栈空间不足，最简单的，就是在方法里，如构造方法里不断申请新的内存空间就够了，如我第二个错误例子的示范。</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">
<h4>站内搜索</h4>
              <div class="navbar-search pull-right">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=8305292233022102519' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
              </div>    

<h4>页面</h4>

 <ul>
  </ul>

<h4>分类</h4>
<ul class="blank">
		<li><a href="/blog/category/android.html">android</a></li>
		<li><a href="/blog/category/api.html">api</a></li>
		<li><a href="/blog/category/git.html">git</a></li>
		<li><a href="/blog/category/go.html">go</a></li>
		<li><a href="/blog/category/hack.html">hack</a></li>
		<li><a href="/blog/category/ios.html">ios</a></li>
		<li><a href="/blog/category/java.html">java</a></li>
		<li><a href="/blog/category/javascript.html">javascript</a></li>
		<li><a href="/blog/category/linux.html">linux</a></li>
		<li><a href="/blog/category/mysql.html">mysql</a></li>
		<li><a href="/blog/category/operation.html">operation</a></li>
		<li><a href="/blog/category/others.html">others</a></li>
		<li><a href="/blog/category/php.html">php</a></li>
		<li><a href="/blog/category/program.html">program</a></li>
		<li><a href="/blog/category/python.html">python</a></li>
		<li><a href="/blog/category/read.html">read</a></li>
		<li><a href="/blog/category/soft.html">soft</a></li>
		<li><a href="/blog/category/success.html">success</a></li>
		<li><a href="/blog/category/test.html">test</a></li>
		<li><a href="/blog/category/vcs.html">vcs</a></li>
		<li><a href="/blog/category/windows.html">windows</a></li>
</ul>


<h4>标签</h4>


<nav class="widget">
  <h4>友情链接</h4>
  <ul class="blank">
    <li><a href="http://bookfuns.com">读书圈</a></li>
    <li><a href="http://123.bookfuns.com">网址大全</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/blog/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/blog/theme/js/libs/gumby.min.js"></script>
  <script src="/blog/theme/js/plugins.js"></script>
</body>
</html>