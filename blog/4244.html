<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>被swoole坑哭的PHP程序员</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/blog/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/blog/theme/pygment.css" />

        <script src="/blog/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/blog/">逍遥の博客 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/blog/">首页</a></li>


              </ul>

            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/blog/4244.html" rel="bookmark"
                   title="Permalink to 被swoole坑哭的PHP程序员">被swoole坑哭的PHP程序员</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="1970-01-01T00:00:00+08:00">
                周四 01 一月 1970
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/blog/author/u0mo5.html"> u0mo5</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>被swoole坑哭的PHP程序员</p>
<p>2015-09-16 09:57 文帅营 博客园 字号：T | T</p>
<p>首先说一下对swoole的理解：披着PHP外衣的C程序。很多PHPer朋友看到swoole提供的强大功能、外界对其的崇拜便跃跃欲试的安装、调 试其demo、编写新功能，然后兴奋的奔走相告。
AD：51CTO 网+首届APP创新评选大赛火热启动——超百万资源等你拿！</p>
<p>本文主要记录一下学习swoole的过程、填过的坑以及swoole究竟有多么强大！
首先说一下对swoole的理解：披着PHP外衣的C程序。很多PHPer朋友看到swoole提供的强大功能、外界对其的崇拜便跃跃欲试的安装、调 试其demo、编写新功能，然后兴奋的奔走相告。没过几天当你按照自己的理解继续用swoole时，发现代码并没有按照自己的预期运行，然后开始破口大 骂，什么破东西呀，代码跟demo基本一样，为啥运行不通呢？什么狗屁work、task、共享内存、ipcs、异步，各种问题涌现，然后迅速去查官方文 档，发现文档中竟然对这些并没有提及，只是简单的介绍怎么使用，此时几乎对swoole丧失希望。</p>
<p>遇到的几点问题：
1：关于phper常用的全局变量（global）为什么在onRequest函数中不能使用。
因为swoole是多线程编程，global是不能在多个进程间共享的。例
 </p>
<p>global $i = 0; </p>
<p>function onRequest() { 
 
    echo $i++; 
 
} </p>
<p>如果在swoole中写一个上面的程序，并不会每次访问输出一个递增的数字。如果要实现预期的效果，需要使用swoole_table的相关函数。
2：什么是异步、什么是回高
对于phper来说，对异步、回调的理解估计就是ajax。当看到swoole里面对异步、回调的解释，貌似很简单的样子，就这样在没有任何多线程编辑经验的时候贸然用了swoole，结果被坑的偷偷撸代码好几个通宵来填自己的坑。
3：为什么onReceive收到的数据这么大
客户端发送的多次请求，服务端是可以一次性接收的。并不是客户端发送一次，服务端接收一次
4：自制httpserve
写一个http服务端，然后通过浏览器访问这个自制的服务器，刷新一次浏览器，服务端为什么为接收到两次请求？这个问题估计困饶了好多初次用swoole写httpserver的朋友。因为浏览器会多发一个favicon.ico请求。
原因
出现这种情况的原因其实很简 单，大部分phper都只会php这一种语言，主要用途就是做web，写业务逻辑。很少去了解服务器程序的开发。有一次一个朋友用swoole写了一个简 单的服务端，一个客户端，跑过来问我为什么都启动了却都收不到数据，我简单看了下代码，所有连接确实都成功了，两端都设置了onReceive回调，代码 没问题，看到最后才发现他的服务端、客户端都设置了接到消息的回调函数，但是两端都没有向对方发消息，两端处于僵持状态。然后swoole官方对于这种常 识问题没有给出说明，只是说如何设置回调、如何发消息，如何这样，如何那样。对于有服务端开发经验的同学来说，肯定不会遇到这种问题，swoole文档也 不需要指明需要这样做，因为这是常识。但对于phper来说，指明这一点是非常重要的，因为如上面所说phper是没有这方面认知的，只有服务端开发经验 的程序员有才会有。
swoole的特色：网络通信 框架、异步、多线程。这些特性正是php所不完善的功能（虽然官方提供很多基础函数可以实现这些功能，然后缺少中文文档，很少有人用php来实现这部分功 能），普通的phper也不具备这些特性的基础认知，所以贸然使用swoole难免会遇到一些根本在swoole官方查不到的常识问题。
使用swoole必须要掌握的技能</p>
<p>多线程编程</p>
<p>进程间通信</p>
<p>网络协议TCP/UDP的认知</p>
<p>PHP的各项基本技能</p>
<p>个人学习swoole的经历
在很久之前我也是一个只会 php的程序员，后来一次偶然机会需要用httpsqs，用了一段时间后发现有一些个性的需求，于是就开始看源码。这真是不看不知道，一看吓一 跳，httpsqs只是一层简单的包装，内部是一个Tokyo Cabinet数据库，印象中封装的代码也就一百多行。主要思路就是用C语言的libevent做了一个http服务器，接收请求读写tokyo cabinet数据库，当时按照这种思路做出来的程序确实不少。后来我就突发奇想，既然C语言可以用libevent函数，那PHP肯定也可以用 libevent监听网络，接收请求后读写数据库做队列服务。后来经过查php官方文档，PHP确实提供一系统完整的函数来完成这些功能，甚至多线程的全 套函数都有提供，但中文文档太少，网上也很少搜索到成熟的代码。在逼不得已的情况下，补习了linux-C多线程开发的基本原理，进程间通信的常用方法， 也用来做了一些简单的demo。唯一的感觉就是写一个简单的功能，设计起来还真复杂。就在快要放弃的时候，swoole出现了。swoole所提供的功能 正是php所缺失的功能，简直是太棒了。swoole做为一种网络通信框架，只需要简单的几行设置，一个服务器就搭建起来了，以后就是不断的去完善业务代 码。之前在libevent交流群中得知swoole的设计在cc++中并不是最好的框架设计，但其亮点就是把基本功能用C封装好，业务功能留给世界上 最好的语言PHP来编写。自此便开始了swoole的填坑之旅。
总结
swoole并不是一个简单的PHP框架，正如swoole官方首页的第一句话“重新定义PHP”，千万不要用旧有php的思想来写swoole代码！swoole重新激活了PHP，php成就了swoole!</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->

<div class="three columns">
<h4>站内搜索</h4>
              <div class="navbar-search pull-right">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=8305292233022102519' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
              </div>    

<h4>页面</h4>

 <ul>
  </ul>

<h4>分类</h4>
<ul class="blank">
		<li><a href="/blog/category/android.html">android</a></li>
		<li><a href="/blog/category/api.html">api</a></li>
		<li><a href="/blog/category/git.html">git</a></li>
		<li><a href="/blog/category/go.html">go</a></li>
		<li><a href="/blog/category/hack.html">hack</a></li>
		<li><a href="/blog/category/ios.html">ios</a></li>
		<li><a href="/blog/category/java.html">java</a></li>
		<li><a href="/blog/category/javascript.html">javascript</a></li>
		<li><a href="/blog/category/linux.html">linux</a></li>
		<li><a href="/blog/category/mysql.html">mysql</a></li>
		<li><a href="/blog/category/operation.html">operation</a></li>
		<li><a href="/blog/category/others.html">others</a></li>
		<li><a href="/blog/category/php.html">php</a></li>
		<li><a href="/blog/category/program.html">program</a></li>
		<li><a href="/blog/category/python.html">python</a></li>
		<li><a href="/blog/category/read.html">read</a></li>
		<li><a href="/blog/category/soft.html">soft</a></li>
		<li><a href="/blog/category/success.html">success</a></li>
		<li><a href="/blog/category/test.html">test</a></li>
		<li><a href="/blog/category/vcs.html">vcs</a></li>
		<li><a href="/blog/category/windows.html">windows</a></li>
</ul>


<h4>标签</h4>


<nav class="widget">
  <h4>友情链接</h4>
  <ul class="blank">
    <li><a href="/">搜索</a></li>
    <li><a href="/123">导航</a></li>
    <li><a href="/doc">文档</a></li>
    <li><a href="/blog">博客</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/blog/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/blog/theme/js/libs/gumby.min.js"></script>
  <script src="/blog/theme/js/plugins.js"></script>
</body>
</html>